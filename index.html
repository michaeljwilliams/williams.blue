<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <title>Michael Williams</title>
    <meta content="Michael Williams, designer, developer, and user experience activist" name="description">
    <meta content="Michael Williams" name="author">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <link href="/img/favicon.png" rel="icon" type="icon">
    <link href="/css/core.css" rel="stylesheet">
</head>

<body>
     
    <header>
        <nav>
            <a href="#/_home.html" class="u-link-plain masthead">Michael Williams</a>
            <a href="#/_posts.html" class="link-nav">Blog</a>
            <a href="#/_work.html" class="link-nav">Work</a>
            <a href="#/_me.html" class="link-nav">Me</a>
        </nav>
    </header>

    <main><div>
        <section class="no-js">
            <p style="color: #006fff">Please use a web browser with JavaScript enabled to view the full site.</p>
            <h2>About me</h2>
            <p>
                Hi! I'm a designer, developer, and user experience activist. I love making the Web a better place by creating elegant, functional designs and user experiences and easy-to-use, fast websites. <a href="mailto:33a1eb@williams.blue">Send me an email!</a>
                <br><br>
                In my spare time I like to read, <a href="https://open.spotify.com/user/mwilliaams">listen to music</a>, play guitar, and explore the great outdoors.
                <br><br>
                I live in sunny San Diego and know of only two seasons: "Warm" and "Hot".
                <br><br>
            </p>
        </section>
        <!-- Removes the no-JS content if JS is enabled. -->
        <script>
            (function(){var a=document.querySelector(".no-js");if(a){a.parentNode.removeChild(a);}})();
        </script>
    </div></main>

    <footer>
        <div class="social-links-div">
            <a href="mailto:33a1eb@williams.blue" class="iconsprite iconsprite-email u-link-plain">Email</a>
            <a href="https://github.com/michaeljwilliams" class="iconsprite iconsprite-github u-link-plain">Code</a>
            <a href="https://open.spotify.com/user/mwilliaams" class="iconsprite iconsprite-spotify u-link-plain">I wanna rock!</a>
        </div>
        <small>Michael Williams</small>
    </footer>

    <script>
    // This script loads the page/template. Code here runs before the page loads, but must come after the main 
    // structural elements because these are referenced in the code.
        ////////////////////////////////////////////////////////////////////////////////
        // Global variables
        var currentPage = {
            url: "/_home.html"
            ,title: "Michael Williams"
            ,historical: false
        };

        ////////////////////////////////////////////////////////////////////////////////
        // Code that runs once, when page initially loads.

        window.onpopstate = function(event) {
            if(event.state !== currentPage) {
                currentPage = event.state;
                currentPage.historical = true;
                loadPage(event.state.url);
            }
        };

        // This will only run once, when the page is first loaded (or refreshed).
        loadPage();

        // Listen for clicks on the page
        document.body.addEventListener("click", somethingWasClicked, false);

        ////////////////////////////////////////////////////////////////////////////////

        function asyncGet(url, cb, errcb) { // Extra args will be passed to cb
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
            xhr.send(null);

            xhr.timeout = 10000;
            xhr.ontimeout = function() {
                console.error("asyncGet: The request for " + url + " timed out after 5 seconds.");
            };

            xhr.onload = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    cb(xhr.response);
                } else { // Log error to console
                    console.error("asyncGet: The request for " + url + " failed with error: " + xhr.statusText);
                    if(errcb) errcb(url);               // Call errcb if given
                }
            };
        }

        function addContent(where, content) {
                document.querySelector(where).appendChild(content);
        }

        // Asynchronously retrieves content, loads into the given location, and calls cb when done.
        function loadContentIntoElement(url, where, cb) {
            asyncGet(url, asyncGetCb);

            function asyncGetCb(content) {
                var parser = new DOMParser();                           // Create a parser for the content
                content = parser.parseFromString(content,"text/html");   // Parse content to create an xml object

                // Create new script tags and append them to <body> so that they will run. 
                // Fill them with the code that we received from asyncGet.
                var scripts = content.body.getElementsByTagName("script");

                // Slight delay so that new content finishes being added to the DOM before the scripts below 
                // (1) try to modify the new content.
                window.setTimeout(function() {      
                    if(scripts.length === 0) {  // If no scripts are loaded, run this now.
                        runAfterPageLoad();     // Otherwise it is called by a script that we loaded.
                    } else {
                        for(var i = 0, l = scripts.length; i < l; i ++) {   // (1) these scripts
                            var script = document.createElement("script");
                            if (!scripts[i].src) {
                                script.innerHTML = scripts[i].innerHTML;
                            } else {
                                script.src = scripts[i].src;
                            }
                            document.body.appendChild(script);
                        }
                    }
                }, 10);

                addContent(where, content.body.firstChild);    // Add the content to the page. 
                // The parsing process created <html> and <body> elements, so content.body bypasses that.
            }
            if(cb) cb(url, where);
        }

        // Does something when something is clicked
        function somethingWasClicked(event) {   // Runs when something is clicked.
        var target = event.target;              // The thing that was clicked

            // Link
            // Check if target is an <a> and has proper href (starts with #/)
            if(target.nodeName === "A" && target.getAttribute("href").substring(0,2) === "#/") {
                internalLinkWasClicked(target); 
            // Check if parent element meets conditions
            } else if(target.parentNode && target.parentNode.nodeName === "A" && target.parentNode.getAttribute("href").substring(0,2) === "#/") {
                internalLinkWasClicked(target.parentNode);
            }
            function internalLinkWasClicked(link) {
                event.preventDefault();         // Prevent unwanted default behavior
                event.stopPropagation();        // We're done with the event now
                loadPage(link.getAttribute("href").substring(1));
            }

            // On-page link
            if(target.className.indexOf("u-link-onpage") !== -1) onpageLinkHandler.linkWasClicked(target);
            if(target.className.indexOf("u-backbutton-link-onpage") !== -1) onpageLinkHandler.backButtonWasClicked();
        }

        // Loads the page
        function loadPage(whichPage) {
            //debugger;
            // Load the page from the url
            if(!whichPage) {
                // If a hash with a slash (#/) is present in the url, attempt to load the content at that path
                var hash = window.location.hash.substring(1);               // Get hash
                if(hash.length !== 0 && hash.substring(0,1) === "/") {      // Check for "#/"
                    whichPage = hash;
                } else whichPage = "/_home.html";
            // Load the page from the given value of whichPage
            } else {
            }

            // Remove old content
            var oldContent = document.querySelector("main").firstChild;
            if(oldContent) oldContent.parentElement.removeChild(oldContent);

            // Update currentPage.url, unless we're moving through browser history.
            if(currentPage.historical === false) {
                currentPage.url = whichPage;
            }
            console.log(currentPage.url);

            loadContentIntoElement(whichPage, "main");          // Load remote content into main.
        }

        // Stuff to do after the page loads. This function is called by a script in the loaded content, or
        // after the new content has been parsed, if no scripts are present.
        // Consider how important things are before putting them here instead of /js/core.js.
        function runAfterPageLoad(url, where) {

            // Add history entry and change URL to reflect the new page - unless we're already moving through 
            // the browser history, in which case these values are already set
            if(currentPage.historical === false) {
                history.pushState(currentPage, currentPage.title, "/index.html#" + currentPage.url);
            }

            // Update page title
            document.querySelector("title").innerHTML = currentPage.title;

        }

    </script>
    <script src="/js/core.js"></script>
</body>
</html>